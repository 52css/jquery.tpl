/**
 * Created by Ivan on 14-2-28.
 * Version: 0.0.1
 */!function(n,e){String.prototype.encodeHTML=function(){var n={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},e=/&(?!#?\w+;)|<|>|"|'|\//g;return function(){return this?this.replace(e,function(e){return n[e]||e}):this}}();var r=function(n){return new a.init(n)},t=function(n){var e=arguments;return n.replace(/\{(\d+)\}/g,function(n,r){return e[+r+1]})},i=0,o=!1,a=r.prototype={init:function(n){var e=this;return e.tpl(n),e},do_write:function(n){return""==n?"":"rtv += ( "+n+" ) ;\n"},do_array:function(n){if(""==n)return"	}\n}\n";var e=n.split(":"),r=e[0],a=e[1]||"value",c=e[2]||"index";return o=!0,t("var obj{0} = {1};\nif (obj{0}) {\n    var {2}, {3} = -1,\n        l1 = obj{0}.length - 1;\n    while ({3} < l1) {\n        {2} = obj{0}[{3} += 1];\n",i++,r,a,c)},do_object:function(n){if(""==n)return"		}\n	}\n}\n";var e=n.split(":"),r=e[0],a=e[1]||"value",c=e[2]||"key";return o=!0,t("var obj{0} = {1};\nif(obj{0}){\n    var {2}, {3};\n    for({3} in obj{0}){\n        if({}.hasOwnProperty.call(obj{0},{3})){\n            {2} = obj{0}[{3}];\n",i++,r,a,c)},do_encode:function(n){return""==n?"":"rtv += ( "+n+" ).toString().encodeHTML() ;\n"},do_if:function(n){return""==n?"}\n":(o=!0,"if ("+n+") {\n")},do_else:function(n){return o=!0,""==n?"} else {\n":"} else if ( "+n+"){\n"},do_use:function(n){return""==n?"":"rtv += ("+r.varname+"._def"+n+" || function(){})();\n"},compile:function(n){var e=this;return void 0!==n?(e._compile=n,e):e._compile.toString()},tpl:function(e){var i=this;return void 0!==e?(i._tpl=e,i._compileStr=function c(e){function i(n,e,t){0==t||e>=n.length||(n=n.slice(e,t).replace(/\\/g,"\\\\").replace(/'/g,"\\'"),r.wrap?(o&&(n=n.replace(/^\s*\n/,""),o=!1),n=n.replace(/\r/g,"\\r").replace(/\n/g,"\\n")):n=n.replace(/\r|\n/g,""),l+="rtv +='"+n+"';\n")}var u,l="var rtv ='';\n",f=0,v=r.code,d=/\{\{##([^\s]+)[^\s]*[\s\n]([\s\S]+?)#\1\}\}/g;for(d.test(e)&&(e=e.replace(d,function(n,e,i){return l+=t("{0}._def{1}=function (){\n {2} \n}\n",r.varname,e,c(i)),""}));u=v.exec(e);){i(e,f,u.index);var p,s=u[1],m=s.slice(0,1),_=n.trim(s.slice(1)),h=r.fn,g={}.hasOwnProperty;g.call(h,m)?(p="do_"+h[m],g.call(a,p)&&(l+=a[p](_))):l+=s,f=u.index+u[0].length}return i(e,f),l+="return rtv;"}(e),i._compile=Function(r.varname,i._compileStr),i):i._tpl},model:function(n){var e=this,t={};return void 0===e._compile?"":e._compile(t[r.varname]=n)}};a.init.prototype=a,n.extend(r,{code:/\{\{([\s\S]+?\}*)\}\}/g,fn:{"=":"write","!":"encode","~":"object","@":"array","?":"if","&":"else","#":"use"},varname:"it",wrap:!1}),n[e]=r,n.fn[e]=function(e){return this.each(function(){var r=n(this);r.data("viewModel")||r.data("viewModel",n.viewModel(r.attr("data-viewModel")||r.html())),r.html(r.data("viewModel").model(e))})}}(jQuery,"viewModel");